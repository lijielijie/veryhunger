 <meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="/static/js/jquery-1.8.2.js"></script>
<script type="text/javascript" src="/static/js/wangEditor.min.js"></script>

<style type="text/css">
#write-title{
	margin-left: 10%;
	width:70%;height:3rem;
	font-weight: 500;font-size: 1.5rem;line-height:3rem;text-align: center;
	background-color: #eee;
	border: none;
}
#write-role{
	width:10%;height:3rem;
	font-weight: 500;font-size: 1rem;line-height:3rem;text-align: center;
	background-color: #eee;
	border: none;
	border-radius: 5px;
}
#write-content{
    margin-left: 10%;
    width:80%;
}
.normal-text{
	margin-left: 10%;
	font-weight: 600;font-size: 1.5rem;color:#888;
}
#write-panl{
	font-size: 1rem;
	background-color: #eee;
	height:25rem;
}
#write-panl .w-e-menu{
	font-size: 1.2rem;
	line-height:1rem;
}
#write-panl p{
	cursor: text;
}
button{
	width: 5rem;
    height: 2rem;
    border-radius: 2px;
    border: none;
    background: #888;
    cursor: pointer;
}
</style>
<div id="pageHead"><script type="text/javascript">$(document).ready(function () {$('#pageHead').load('/head')});</script></div>
<br>
<div class="normal-text" >标题：</div>
<div style="display: inline-block;width: 100%;">
	<input id="write-title" ></input>
	<select id="write-role" >
		<option>公开</option>
		<option>私人</option>
	</select>
	<input id="write-uuid" style="display:none"></input>
</div>
<div class="normal-text" >正文：</div>
<div id="write-content">
	<div id="write-panl"></div>
</div>
<br>
<div id="write-submit" style="text-align: right;">
	<button style="background-color: #2196F3;margin-right:1rem;" onclick="uploadArticle()">保存</button>
	<button style="background-color: #dd5986;margin-right:10rem;" onclick="clearArticle()">重置</button>
</div>

<script>
	var E = window.wangEditor;
	var editor = new E('#write-panl');
	editor.customConfig.debug = true;
	editor.customConfig.uploadImgServer = '/upload/uploadArticleImage'
	editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024;
	editor.customConfig.uploadImgMaxLength = 1;
	editor.customConfig.onchange = function (html) {
		document.getElementById('fontCount').innerText=editor.txt.text().length;
    }
	editor.customConfig.customUploadImg = function (files, insert) {
		for(var n=0;n<files.length;n++){
			var formData = new FormData();//初始化一个FormData对象
			formData.append("file", files[n]);//将文件塞入FormData
			$.ajax({
				url : "/upload/uploadArticleImage?fileName="+files[n].name,
				type : "POST",
				data : formData,
				async:false, 
				processData : false, // 告诉jQuery不要去处理发送的数据
				contentType : false, // 告诉jQuery不要去设置Content-Type请求				
				success : function(imageSrc) {
					insert(imageSrc);
				}
			});
		}
	}
	editor.create();
	
	function clearArticle(){
		var r=confirm("确认清空所有文字?");
	  	if (r==true){//选择取消
	  		editor.txt.clear();
	  	}
	}
	function uploadArticle(){
		if ($('#write-title').val()==""||$('#write-title').val()=="请把我填上标题，谢谢！！") {
			alert("请把我填上标题，谢谢！！");
			return;
		}
		if (editor.txt.text()=="") {
			alert('<p>稍微写点东西吧</p>')
			return;
		}
		var r=confirm("确认提交保存?");
	  	if (r==false){//选择取消
	  		return;
	  	}
		$.ajax({
			url : "/article/uploadArticle",
			type : "POST",
			data : {articleUuid:$('#write-uuid').val(),articleRole:$('#write-role option:selected').val(),articleCentent:editor.txt.html(),title:$('#write-title').val()},
			async:false, 
			success : function(articleUuid) {
				if(articleUuid!=""&&articleUuid.length==32){
					$('#write-uuid').val(articleUuid);
					alert("保存成功!\r\n您可以继续编辑，文本再次保存后会更新上一次保存的文本");
				}else{
					alert("保存失败!请联系管理员")
				}
			}
		});
	}
</script>
